Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var a=this.length>>>0,e=Number(arguments[1])||0;for(e=0>e?Math.ceil(e):Math.floor(e),0>e&&(e+=a);a>e;e++)if(e in this&&this[e]===t)return e;return-1});var app=angular.module("LoanCalculatorApp",["googlechart","ngMaterial","ngMessages","ng-bs3-datepicker"]);app.controller("LoanCalculatorCtr",["$scope","$filter","$timeout","$location","$http",function(t,a,e,n,o){t.amortization_schedule=[],t.yearly_amortization_schedule=[],t.drawcharts=!0,t.monthlyamortizationtable=!0,t.annualamortizationtable=!0,t.amountAdditionalMonthly=0,t.amountAdditionalYearly=0,t.dateAdditionalYearly="",t.id=0,t.amountOneTimePaymentList=[],t.dateOneTimePaymentList=[],t.oneTimePaymentList=[],t.totalAmountExtraPayment=0,t.pageIsLoading=!1,t.amortization_schedule_show=!1,t.extra_payments_information_show=!1,t.loan_extra_payment_summary_show=!1,t.add_extra_payments_form_show=!1,t.output_parameters_show=!1,t.dont_show_no_result=!0,t.cd=n.host();var i="lo",r="an",l="ca",m="lc",s="ul",c="at",y="or",u=".",p="p",d="w",h="";t.pd=i+r+l+m+s+c+y+u+p+d+h,t.pdw="www."+t.pd,t.showOutputParameters=function(){t.output_parameters_show?t.output_parameters_show=!1:t.output_parameters_show=!0},t.addExtraPaymentForm=function(){t.add_extra_payments_form_show?t.add_extra_payments_form_show=!1:t.add_extra_payments_form_show=!0},t.showAmortizationSchedule=function(){t.amortization_schedule_show?t.amortization_schedule_show=!1:t.amortization_schedule_show=!0},t.copareDate=function(a){var e=new Date("1 "+a),n=new Date("1 "+t.loanstartdate),o=new Date("1 "+t.payoffdate);return e>=n&&o>e},t.urlDrawcharts=function(){n.search("drawcharts",t.drawcharts?1:0)},t.urlAnnual=function(){n.search("annualamortizationtable",t.annualamortizationtable?1:0)},t.urlMonthly=function(){n.search("monthlyamortizationtable",t.monthlyamortizationtable?1:0)},t.applyExtraPayments=function(){try{if(t.pageIsLoading=!0,t.amortization_schedule_show=!1,t.extra_payments_information_show=!1,t.loan_extra_payment_summary_show=!1,t.output_parameters_show=!1,t.totalAmountExtraPayment=0,t.dont_show_no_result=!1,e(function(){var a=new Object;a.loanamount=t.loanamount?Number(t.loanamount.replace(/,/g,"")):0,a.loanterminmonths=t.loanterminmonths,a.interestrateperyear=t.interestrateperyear,a.loanstartdate=t.loanstartdate,a.drawcharts=t.drawcharts?1:0,a.annualamortizationtable=t.annualamortizationtable?1:0,a.monthlyamortizationtable=t.monthlyamortizationtable?1:0,a.calcfunc="applyExtraPayments",a.amountAdditionalMonthly=t.amountAdditionalMonthly?Number(t.amountAdditionalMonthly.replace(/,/g,"")):0,a.amountAdditionalYearly=t.amountAdditionalYearly?Number(t.amountAdditionalYearly.replace(/,/g,"")):0,a.dateAdditionalYearly=t.dateAdditionalYearly,a.oneTimePaymentList=t.oneTimePaymentList,a.amountOneTimePaymentList=[],a.dateOneTimePaymentList=[],angular.forEach(t.oneTimePaymentList,function(e,n){a.amountOneTimePaymentList.push(t.amountOneTimePaymentList[e]),a.dateOneTimePaymentList.push(t.dateOneTimePaymentList[e])}),n.search(a)}),t.pd!=t.cd&&t.pdw!=t.cd)return;e(function(){var a="loanamount="+t.loanamount;a+="&loanterminmonths="+t.loanterminmonths,a+="&interestrateperyear="+t.interestrateperyear,a+="&loanstartdate="+t.loanstartdate,a+="&loanstartdate="+t.loanstartdate,a+="&amountAdditionalMonthly="+t.amountAdditionalMonthly,a+="&amountAdditionalYearly="+t.amountAdditionalYearly,a+="&dateAdditionalYearly="+t.dateAdditionalYearly,angular.forEach(t.oneTimePaymentList,function(e,n){a+="&oneTimePaymentList[]="+e,a+="&amountOneTimePaymentList[]="+t.amountOneTimePaymentList[e],a+="&dateOneTimePaymentList[]="+t.dateOneTimePaymentList[e]});var e="extrapaymentcalculate.php?";e+=a,o.get(e).then(function(a){var e=a.data;t.payoffdate=e.payoffdate,t.total_interest_paid=e.total_interest_paid,t.total_interest_paid_percent=e.total_interest_paid_percent,t.total_principal_paid=e.total_principal_paid,t.total_principal_paid_percent=e.total_principal_paid_percent,t.total_paid=e.total_paid,t.months=e.months,t.monthly_payment=e.monthly_payment,t.amortization_schedule=e.amortization_schedule,t.yearly_amortization_schedule=e.yearly_amortization_schedule,t.extrapayment_monthly_payment=e.extrapayment_monthly_payment,t.extrapayment_months=e.extrapayment_months,t.totalAmountExtraPayment=e.totalAmountExtraPayment,t.extrapayment_total_paid=e.extrapayment_total_paid,t.extrapayment_total_interest_paid=e.extrapayment_total_interest_paid,t.extrapayment_payoffdate=e.extrapayment_payoffdate;var n=e.yearly_date,o=e.yearly_payment,i=e.yearly_principal,r=e.yearly_interest,l=e.yearly_balance;t.loanchart2(t.extrapayment_monthly_payment,t.extrapayment_total_interest_paid,""),t.lineYearlyAmortizationChart(n,o,i,r),t.lineYearlyBalanceChart(n,l),t.lineMonthlyAmortizationChart(),t.lineMonthlyBalanceChart(),t.pageIsLoading=!1,t.amortization_schedule_show=!0,t.extra_payments_information_show=!0,t.loan_extra_payment_summary_show=!0,t.add_extra_payments_form_show=!1},function(t){})})}catch(a){alert("applyExtraPayments function has error........")}},t.calculate=function(){try{if(t.pageIsLoading=!0,t.amortization_schedule_show=!1,t.extra_payments_information_show=!1,t.loan_extra_payment_summary_show=!1,t.add_extra_payments_form_show=!1,t.output_parameters_show=!1,t.dont_show_no_result=!1,t.pd!=t.cd&&t.pdw!=t.cd)return;e(function(){var a=new Object;a.loanamount=t.loanamount?Number(t.loanamount.replace(/,/g,"")):0,a.loanterminmonths=t.loanterminmonths,a.interestrateperyear=t.interestrateperyear,a.loanstartdate=t.loanstartdate,a.drawcharts=t.drawcharts?1:0,a.annualamortizationtable=t.annualamortizationtable?1:0,a.monthlyamortizationtable=t.monthlyamortizationtable?1:0,a.calcfunc="calculate",a.amountAdditionalMonthly=t.amountAdditionalMonthly?Number(t.amountAdditionalMonthly.replace(/,/g,"")):0,a.amountAdditionalYearly=t.amountAdditionalYearly?Number(t.amountAdditionalYearly.replace(/,/g,"")):0,a.dateAdditionalYearly=t.dateAdditionalYearly,a.oneTimePaymentList=t.oneTimePaymentList,a.amountOneTimePaymentList=[],a.dateOneTimePaymentList=[],angular.forEach(t.oneTimePaymentList,function(e,n){a.amountOneTimePaymentList.push(t.amountOneTimePaymentList[e]),a.dateOneTimePaymentList.push(t.dateOneTimePaymentList[e])}),n.search(a)}),e(function(){var a="loanamount="+t.loanamount;a+="&loanterminmonths="+t.loanterminmonths,a+="&interestrateperyear="+t.interestrateperyear,a+="&loanstartdate="+t.loanstartdate;var e="calculate.php?";e+=a,o.get(e).then(function(a){var e=a.data;t.payoffdate=e.payoffdate,t.total_interest_paid=e.total_interest_paid,t.total_interest_paid_percent=e.total_interest_paid_percent,t.total_principal_paid=e.total_principal_paid,t.total_principal_paid_percent=e.total_principal_paid_percent,t.total_paid=e.total_paid,t.months=e.months,t.monthly_payment=e.monthly_payment,t.amortization_schedule=e.amortization_schedule,t.yearly_amortization_schedule=e.yearly_amortization_schedule;var n=e.yearly_date,o=e.yearly_payment,i=e.yearly_principal,r=e.yearly_interest,l=e.yearly_balance;t.loanchart(),t.lineYearlyAmortizationChart(n,o,i,r),t.lineYearlyBalanceChart(n,l),t.lineMonthlyAmortizationChart(),t.lineMonthlyBalanceChart(),t.pageIsLoading=!1,t.amortization_schedule_show=!0},function(t){})})}catch(a){alert("calculate function has error........")}},t.loanchart2=function(a,e,n){t.chartObject={},t.chartObject.data={cols:[{id:"t",label:"Topping",type:"string"},{id:"s",label:"Slices",type:"number"}],rows:[{c:[{v:"Total Interest Paid"},{v:Math.round(100*e)/100}]},{c:[{v:"Total Principal Paid"},{v:Number(t.loanamount.replace(/,/g,""))}]}]},t.chartObject.type="PieChart",t.chartObject.options={title:"$"+Math.round(100*a)/100+" MONTHLY PAYMENTS"+n,is3D:!1,backgroundColor:"#f5f3e5",fontSize:16,fontName:"tohoma",legend:{position:"bottom",textStyle:{fontSize:12}},pieHole:.4,pieSliceTextStyle:{color:"black"}},t.chartObject.formatters={number:[{columnNum:1,prefix:"$"}]}},t.loanchart=function(){t.chartObject={},t.chartObject.data={cols:[{id:"t",label:"Topping",type:"string"},{id:"s",label:"Slices",type:"number"}],rows:[{c:[{v:"Total Interest Paid"},{v:Math.round(100*t.total_interest_paid)/100}]},{c:[{v:"Total Principal Paid"},{v:Number(t.loanamount.replace(/,/g,""))}]}]},t.chartObject.type="PieChart",t.chartObject.options={title:"$"+Math.round(100*t.monthly_payment)/100+" MONTHLY PAYMENTS",is3D:!1,backgroundColor:"#f5f3e5",fontSize:16,fontName:"tohoma",legend:{position:"bottom",textStyle:{fontSize:12}},pieHole:.4,pieSliceTextStyle:{color:"black"}},t.chartObject.formatters={number:[{columnNum:1,prefix:"$"}]}},t.loanchartWithPrepayment=function(){t.chartPrepaymentObject={},t.chartPrepaymentObject.data={cols:[{id:"t",label:"Topping",type:"string"},{id:"s",label:"Slices",type:"number"}],rows:[{c:[{v:"Total Interest Paid"},{v:Math.round(100*t.extrapayment_total_interest_paid)/100}]},{c:[{v:"Total Principal Paid"},{v:Number(t.loanamount.replace(/,/g,""))}]}]},t.chartPrepaymentObject.type="PieChart",t.chartPrepaymentObject.options={title:"$"+Math.round(100*t.extrapayment_monthly_payment)/100+" MONTHLY PAYMENTS",is3D:!1,backgroundColor:"#f5f3e5",fontSize:16,fontName:"tohoma",legend:{position:"bottom",textStyle:{fontSize:12}},pieHole:.4,pieSliceTextStyle:{color:"black"}},t.chartPrepaymentObject.formatters={number:[{columnNum:1,prefix:"$"}]}},t.lineYearlyBalanceChart=function(e,n){var o={};o.type="LineChart";var i={};i.cols=[],i.cols.push({id:"y",label:"Years",type:"string"}),i.cols.push({id:"i",label:"Balance",type:"number"}),i.rows=[];var r=t.loanamount?Number(t.loanamount.replace(/,/g,"")):0,l={};l.c=[],l.c.push({v:"START"}),l.c.push({v:r,f:a("currency")(r,"$",2)}),i.rows.push(l),angular.forEach(e,function(t,e){var o={};o.c=[],o.c.push({v:e}),o.c.push({v:n[e],f:a("currency")(n[e],"$",2)}),i.rows.push(o)}),o.data=i,o.options={title:"YEARLY BALANCE CHART",is3D:!1,backgroundColor:"",fontSize:16,fontName:"tohoma",legend:{position:"right",textStyle:{fontSize:12}},pieHole:.4,pieSliceTextStyle:{color:"black"}},o.formatters={},t.lineYearlyBalanceChartObject=o},t.lineYearlyAmortizationChart=function(e,n,o,i){var r={};r.type="LineChart";var l={};l.cols=[],l.cols.push({id:"y",label:"Years",type:"string"}),l.cols.push({id:"i",label:"Interest Paid",type:"number"}),l.cols.push({id:"p",label:"Principal Paid",type:"number"}),l.cols.push({id:"a",label:"Payment",type:"number"}),l.rows=[],angular.forEach(e,function(t,e){var r={};r.c=[],r.c.push({v:e}),r.c.push({v:i[e],f:a("currency")(i[e],"$",2)}),r.c.push({v:o[e],f:a("currency")(o[e],"$",2)}),r.c.push({v:n[e],f:a("currency")(n[e],"$",2)}),l.rows.push(r)}),r.data=l,r.options={title:"YEARLY AMORTIZATION CHART",is3D:!1,backgroundColor:"",fontSize:16,fontName:"tohoma",legend:{position:"right",textStyle:{fontSize:12}},pieHole:.4,pieSliceTextStyle:{color:"black"}},r.formatters={},t.lineYearlyAmortizationChartObject=r},t.lineYearlyAmortizationAnnotationChart=function(e,n,o,i){var r={};r.type="AnnotationChart";var l={};l.cols=[],l.cols.push({id:"y",label:"Years",type:"date"}),l.cols.push({id:"a",label:"Payment",type:"number"}),l.cols.push({id:"p",label:"Principal Paid",type:"number"}),l.cols.push({id:"i",label:"Interest Paid",type:"number"}),l.rows=[];var m=t.loanstartdate.split(" ")[0];m="JAN",angular.forEach(e,function(t,e){var r=new Date(m+" 1 "+e),s={};s.c=[],s.c.push({v:r}),s.c.push({v:n[e],f:a("currency")(n[e],"$",2)}),s.c.push({v:o[e],f:a("currency")(o[e],"$",2)}),s.c.push({v:i[e],f:a("currency")(i[e],"$",2)}),l.rows.push(s)}),r.data=l,r.options={title:"YEARLY AMORTIZATION CHART",is3D:!1,backgroundColor:"",displayAnnotations:!1,displayAnnotationsFilter:!0,allValuesSuffix:"",displayLegendValues:!0,displayRangeSelector:!1,displayZoomButtons:!1,numberFormats:"$0.00",dateFormat:"yyyy",fontSize:16,fontName:"tohoma",legend:{position:"right",textStyle:{fontSize:12}},pieHole:.4,pieSliceTextStyle:{color:"black"}},r.formatters={},t.lineYearlyAmortizationAnnotationChartObject=r},t.lineYearlyAmortizationFullChart=function(e,n,o,i,r){var l={};l.type="LineChart";var m={};m.cols=[],m.cols.push({id:"y",label:"Years",type:"string"}),m.cols.push({id:"i",label:"Interest Paid",type:"number"}),m.cols.push({id:"p",label:"Principal Paid",type:"number"}),m.cols.push({id:"a",label:"Payment",type:"number"}),m.cols.push({id:"d",label:"Balance",type:"number"}),m.rows=[];var s=t.loanamount?Number(t.loanamount.replace(/,/g,"")):0,c={};c.c=[],c.c.push({v:"START"}),c.c.push({v:0,f:"$0"}),c.c.push({v:0,f:"$0"}),c.c.push({v:0,f:"$0"}),c.c.push({v:s,f:a("currency")(s,"$",2)}),m.rows.push(c),angular.forEach(e,function(t,e){var l={};l.c=[],l.c.push({v:e}),l.c.push({v:i[e],f:a("currency")(i[e],"$",2)}),l.c.push({v:o[e],f:a("currency")(o[e],"$",2)}),l.c.push({v:n[e],f:a("currency")(n[e],"$",2)}),l.c.push({v:r[e],f:a("currency")(r[e],"$",2)}),m.rows.push(l)}),l.data=m,l.options={title:"YEARLY AMORTIZATION CHART",is3D:!1,backgroundColor:"",fontSize:16,fontName:"tohoma",legend:{position:"right",textStyle:{fontSize:12}},pieHole:.4,pieSliceTextStyle:{color:"black"}},l.formatters={},t.lineYearlyAmortizationFullChartObject=l},t.lineMonthlyAmortizationChart=function(){t.lineMonthlyAmortizationChartObject="";var e={};e.type="LineChart";var n={};n.cols=[],n.cols.push({id:"y",label:"Time",type:"string"}),n.cols.push({id:"i",label:"Interest Paid",type:"number"}),n.cols.push({id:"p",label:"Principal Paid",type:"number"}),n.cols.push({id:"a",label:"Payment",type:"number"}),n.rows=[],angular.forEach(t.amortization_schedule,function(t,e){var o={};o.c=[],o.c.push({v:t.payment_date}),o.c.push({v:t.interest_part,f:a("currency")(t.interest_part,"$",2)}),o.c.push({v:t.principal_part,f:a("currency")(t.principal_part,"$",2)}),o.c.push({v:t.monthly_payment,f:a("currency")(t.monthly_payment,"$",2)}),n.rows.push(o)}),e.data=n,e.options={title:"MONTHLY AMORTIZATION CHART",is3D:!1,backgroundColor:"",fontSize:16,fontName:"tohoma",legend:{position:"right",textStyle:{fontSize:12}},pieHole:.4,pieSliceTextStyle:{color:"black"}},e.formatters={},t.lineMonthlyAmortizationChartObject=e},t.lineMonthlyBalanceChart=function(){var e={};e.type="LineChart";var n={};n.cols=[],n.cols.push({id:"m",label:"Monthly",type:"string"}),n.cols.push({id:"b",label:"Balance",type:"number"}),n.rows=[];var o=t.loanamount?Number(t.loanamount.replace(/,/g,"")):0,i={};i.c=[],i.c.push({v:"START"}),i.c.push({v:o,f:a("currency")(o,"$",2)}),n.rows.push(i),angular.forEach(t.amortization_schedule,function(t,e){var o={};o.c=[],o.c.push({v:t.payment_date}),o.c.push({v:t.balance,f:a("currency")(t.balance,"$",2)}),n.rows.push(o)}),e.data=n,e.options={title:"MONTHLY BALANCE CHART",is3D:!1,backgroundColor:"",fontSize:16,fontName:"tohoma",legend:{position:"right",textStyle:{fontSize:12}},pieHole:.4,pieSliceTextStyle:{color:"black"}},e.formatters={},t.lineMonthlyBalanceChartObject=e},t.Calloanterminmonths=function(){t.loanterminmonths=Math.round(12*t.loanterminyears)},t.Calloanterminyears=function(){t.loanterminmonths=Math.round(t.loanterminmonths);var a=t.loanterminmonths/12;t.loanterminyears=a.toFixed(2)},t.centerCtrl=function(){var o=n.search();"calculate"==o.calcfunc?(e(function(){t.loanamount=o.loanamount,t.loanterminmonths=o.loanterminmonths,t.interestrateperyear=o.interestrateperyear,t.loandefaultdate=t.loanstartdate=o.loanstartdate,t.loanterminyears=o.loanterminmonths/12,t.drawcharts=Number(o.drawcharts)?!0:!1,t.annualamortizationtable=Number(o.annualamortizationtable)?!0:!1,t.monthlyamortizationtable=Number(o.monthlyamortizationtable)?!0:!1,t.amountAdditionalMonthly=o.amountAdditionalMonthly,t.amountAdditionalYearly=o.amountAdditionalYearly,t.dateAdditionalYearly=o.dateAdditionalYearly,"string"==typeof o.oneTimePaymentList?(t.oneTimePaymentList.push(o.oneTimePaymentList),t.amountOneTimePaymentList[t.oneTimePaymentList[0]]=o.amountOneTimePaymentList,t.dateOneTimePaymentList[t.oneTimePaymentList[0]]=o.dateOneTimePaymentList,t.id=Number(t.oneTimePaymentList[0].replace("onetimepayment-",""))):"object"==typeof o.oneTimePaymentList?(t.oneTimePaymentList=o.oneTimePaymentList,angular.forEach(t.oneTimePaymentList,function(a,e){t.amountOneTimePaymentList[a]=o.amountOneTimePaymentList[e],t.dateOneTimePaymentList[a]=o.dateOneTimePaymentList[e]}),t.id=Number(t.oneTimePaymentList[t.oneTimePaymentList.length-1].replace("onetimepayment-",""))):"undefined"==typeof o.oneTimePaymentList&&(t.id=1),t.dont_show_no_result=!1}),e(function(){t.calculate()})):"applyExtraPayments"==o.calcfunc?(e(function(){t.loanamount=o.loanamount,t.loanterminmonths=o.loanterminmonths,t.interestrateperyear=o.interestrateperyear,t.loandefaultdate=t.loanstartdate=o.loanstartdate,t.loanterminyears=o.loanterminmonths/12,t.drawcharts=o.drawcharts?!0:!1,t.annualamortizationtable=Number(o.annualamortizationtable)?!0:!1,t.monthlyamortizationtable=Number(o.monthlyamortizationtable)?!0:!1,t.amountAdditionalMonthly=o.amountAdditionalMonthly,t.amountAdditionalYearly=o.amountAdditionalYearly,t.dateAdditionalYearly=o.dateAdditionalYearly,"string"==typeof o.oneTimePaymentList?(t.oneTimePaymentList.push(o.oneTimePaymentList),t.amountOneTimePaymentList[t.oneTimePaymentList[0]]=o.amountOneTimePaymentList,t.dateOneTimePaymentList[t.oneTimePaymentList[0]]=o.dateOneTimePaymentList,t.id=Number(t.oneTimePaymentList[0].replace("onetimepayment-",""))):"object"==typeof o.oneTimePaymentList?(t.oneTimePaymentList=o.oneTimePaymentList,angular.forEach(t.oneTimePaymentList,function(a,e){t.amountOneTimePaymentList[a]=o.amountOneTimePaymentList[e],t.dateOneTimePaymentList[a]=o.dateOneTimePaymentList[e]}),t.id=Number(t.oneTimePaymentList[t.oneTimePaymentList.length-1].replace("onetimepayment-",""))):"undefined"==typeof o.oneTimePaymentList&&(t.id=1),t.dont_show_no_result=!1}),e(function(){t.applyExtraPayments()})):(t.loanamount="100000",t.loanterminyears=3,t.loanterminmonths=36,t.interestrateperyear=6,t.loandefaultdate=t.loanstartdate=a("date")(new Date,"MMM yyyy",0))},t.centerCtrl()}]),app.directive("moneyNum",["$filter",function(t){return{restrict:"A",link:function(a,e,n){a.addaOneTimePayment=function(){var t=Object.keys(a.dateOneTimePaymentList);a.loandefaultdate=a.dateOneTimePaymentList[t[t.length-1]]?a.dateOneTimePaymentList[t[t.length-1]]:a.loandefaultdate,a.id=a.id+1,a.oneTimePaymentList.push("onetimepayment-"+a.id),a.amountOneTimePaymentList["onetimepayment-"+a.id]=0,a.dateOneTimePaymentList["onetimepayment-"+a.id]=a.loandefaultdate},a.removeaOneTimePayment=function(t){var e=a.oneTimePaymentList.indexOf(t);a.oneTimePaymentList.splice(e,1),delete a.amountOneTimePaymentList[t],delete a.dateOneTimePaymentList[t]},e.on("focus",function(){var t=e.val(),a=t.replace(/,/g,"");e.val(a)}),e.on("blur",function(){var a=e.val(),n=t("currency")(a,"",0);e.val(n)}),e.on("click",function(){"loanamountid"!=e.attr("id")&&(this.selectionStart=0,this.selectionEnd=999)})}}}]),app.directive("ymNum",function(){return{restrict:"A",link:function(t,a,e){a.on("click",function(){this.selectionStart=0,this.selectionEnd=999})}}});